{"version":3,"sources":["../../src/controllers/phasorMap_ctrl.js"],"names":["MetricsPanelCtrl","_","moment","TileServers","PhasorMapCtrl","$scope","$injector","$rootScope","events","on","onInitEditMode","bind","onPanelTeardown","onRender","onPanelInitialized","onDataRecieved","onDataError","onRefresh","panel","mapBackgrounds","Object","keys","mapBackground","undefined","maxZoom","options","minZoom","zoomLevel","lockMap","maxLongitude","maxLatitude","minLatitude","minLongitude","circleRadius","angleMarkerWidth","minAngleMarkerWidth","maxAngleMarkerWidth","showMinAngle","showMaxAngle","useReferenceValue","referencePointTag","useAngleMean","angleMeanTimeWindow","showLegend","tileLayer","mapContainer","circleMarkers","data","addEditorTab","map","off","ctrl","height","row","render","console","log","createMap","plotPhasorData","msg","mapOptions","zoomControl","attributionControl","boxZoom","doubleClickZoom","dragging","zoomDelta","L","id","url","addTo","updateMapView","event","getZoom","bounds","getBounds","_southWest","lng","_northEast","lat","refresh","div","canvas","$","children","context","getContext","clearRect","width","center","x","y","chartRadius","drawBackground","lineWidth","strokeStyle","beginPath","arc","Math","PI","stroke","fillStyle","fill","drawGrid","i","drawVector","drawCircle","drawPhasors","vMax","iMax","each","phasorData","key","series","color","dataPoint","vector","xaxisHover","scale","setLineDash","r","t","cos","sin","moveTo","lineTo","drawAngleArrow","angle","radians","headlen","drawMagCircle","magnitude","drawLine","magvalue","minanglevalue","maxanglevalue","anglevalue","element","index","list","remove","parseInt","toString","divIcon","html","iconSize","circle","marker","latitude","longitude","icon","popup","window","open","encodeURIComponent","anglepointtag","magpointtag","dashboard","time","from","to","push","updatePhasorChart","_icon","tolongitude","tolatitude","line","powervalue","polyline","toanglepointtag","powerpointtag","decorator","polylineDecorator","patterns","offset","repeat","symbol","Symbol","arrowHead","pixelSize","pathOptions","fillOpacity","weight","setZoom","fitBounds","markerGroup","featureGroup","isValid","min","max","step","input","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuBSA,4B,kBAAAA,gB;;AAGFC,a;;AACAC,kB;;AAEEC,uB,gBAAAA,W;;;;;;;;;;;;;;;;;;;;;qCAEIC,a;;;AACT;AACA,uCAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,UAA/B,EAA2C;AAAA;;AAAA,8IACjCF,MADiC,EACzBC,SADyB;;AAGvC,0BAAKE,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,OAAjC;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKG,eAAL,CAAqBD,IAArB,OAAjC;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKI,QAAL,CAAcF,IAAd,OAAzB;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,mBAAf,EAAoC,MAAKK,kBAAL,CAAwBH,IAAxB,OAApC;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKM,cAAL,CAAoBJ,IAApB,OAAhC;AACA;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKO,WAAL,CAAiBL,IAAjB,OAA7B;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,SAAf,EAA0B,MAAKQ,SAAL,CAAeN,IAAf,OAA1B;;AAEA;AACA,0BAAKO,KAAL,CAAWC,cAAX,GAA4BC,OAAOC,IAAP,CAAYlB,WAAZ,CAA5B;AACA,0BAAKe,KAAL,CAAWI,aAAX,GAA6B,MAAKJ,KAAL,CAAWI,aAAX,IAA4BC,SAA5B,GAAwC,MAAKL,KAAL,CAAWI,aAAnD,GAAmE,MAAKJ,KAAL,CAAWC,cAAX,CAA0B,CAA1B,CAAhG;AACA,0BAAKD,KAAL,CAAWM,OAAX,GAA4BrB,YAAY,MAAKe,KAAL,CAAWI,aAAvB,EAAsCG,OAAtC,CAA8CD,OAA1E;AACA,0BAAKN,KAAL,CAAWQ,OAAX,GAA6BvB,YAAY,MAAKe,KAAL,CAAWI,aAAvB,EAAsCG,OAAtC,CAA8CC,OAA9C,IAAyDH,SAAzD,GAAqEpB,YAAY,MAAKe,KAAL,CAAWI,aAAvB,EAAsCG,OAAtC,CAA8CC,OAAnH,GAA6H,CAA1J;AACA,0BAAKR,KAAL,CAAWS,SAAX,GAA6B,MAAKT,KAAL,CAAWS,SAAX,IAA8BJ,SAA9B,GAA0C,MAAKL,KAAL,CAAWS,SAArD,GAAqExB,YAAY,MAAKe,KAAL,CAAWI,aAAvB,EAAsCG,OAAtC,CAA8CD,OAAhJ;AACA,0BAAKN,KAAL,CAAWU,OAAX,GAA6B,MAAKV,KAAL,CAAWU,OAAX,IAA8BL,SAA9B,GAA0C,MAAKL,KAAL,CAAWU,OAArD,GAAqE,IAAlG;AACA,0BAAKV,KAAL,CAAWW,YAAX,GAA6B,MAAKX,KAAL,CAAWW,YAAX,IAA8BN,SAA9B,GAA0C,MAAKL,KAAL,CAAWW,YAArD,GAAqE,CAAC,GAAnG;AACA,0BAAKX,KAAL,CAAWY,WAAX,GAA6B,MAAKZ,KAAL,CAAWY,WAAX,IAA8BP,SAA9B,GAA0C,MAAKL,KAAL,CAAWY,WAArD,GAAqE,EAAlG;AACA,0BAAKZ,KAAL,CAAWa,WAAX,GAA6B,MAAKb,KAAL,CAAWa,WAAX,IAA8BR,SAA9B,GAA0C,MAAKL,KAAL,CAAWa,WAArD,GAAqE,EAAlG;AACA,0BAAKb,KAAL,CAAWc,YAAX,GAA6B,MAAKd,KAAL,CAAWc,YAAX,IAA8BT,SAA9B,GAA0C,MAAKL,KAAL,CAAWc,YAArD,GAAqE,CAAC,EAAnG;AACA,0BAAKd,KAAL,CAAWe,YAAX,GAA2B,MAAKf,KAAL,CAAWe,YAAX,IAA2BV,SAA3B,GAAuC,MAAKL,KAAL,CAAWe,YAAlD,GAAiE,EAA5F;AACA,0BAAKf,KAAL,CAAWgB,gBAAX,GAA+B,MAAKhB,KAAL,CAAWgB,gBAAX,IAA+BX,SAA/B,GAA2C,MAAKL,KAAL,CAAWgB,gBAAtD,GAAyE,CAAxG;AACA,0BAAKhB,KAAL,CAAWiB,mBAAX,GAAkC,MAAKjB,KAAL,CAAWiB,mBAAX,IAAkCZ,SAAlC,GAA8C,MAAKL,KAAL,CAAWiB,mBAAzD,GAA+E,CAAjH;AACA,0BAAKjB,KAAL,CAAWkB,mBAAX,GAAkC,MAAKlB,KAAL,CAAWkB,mBAAX,IAAkCb,SAAlC,GAA8C,MAAKL,KAAL,CAAWkB,mBAAzD,GAA+E,CAAjH;AACA,0BAAKlB,KAAL,CAAWmB,YAAX,GAA2B,MAAKnB,KAAL,CAAWmB,YAAX,IAA2Bd,SAA3B,GAAuC,MAAKL,KAAL,CAAWmB,YAAlD,GAAiE,IAA5F;AACA,0BAAKnB,KAAL,CAAWoB,YAAX,GAA2B,MAAKpB,KAAL,CAAWoB,YAAX,IAA2Bf,SAA3B,GAAuC,MAAKL,KAAL,CAAWoB,YAAlD,GAAiE,IAA5F;;AAEA,0BAAKpB,KAAL,CAAWqB,iBAAX,GAAgC,MAAKrB,KAAL,CAAWqB,iBAAX,IAAgChB,SAAhC,GAA4C,MAAKL,KAAL,CAAWqB,iBAAvD,GAA2E,KAA3G;AACA,0BAAKrB,KAAL,CAAWsB,iBAAX,GAAgC,MAAKtB,KAAL,CAAWsB,iBAAX,IAAgCjB,SAAhC,GAA4C,MAAKL,KAAL,CAAWsB,iBAAvD,GAA2E,EAA3G;AACA,0BAAKtB,KAAL,CAAWuB,YAAX,GAA2B,MAAKvB,KAAL,CAAWuB,YAAX,IAA2BlB,SAA3B,GAAuC,MAAKL,KAAL,CAAWuB,YAAlD,GAAiE,KAA5F;AACA,0BAAKvB,KAAL,CAAWwB,mBAAX,GAAkC,MAAKxB,KAAL,CAAWwB,mBAAX,IAAkCnB,SAAlC,GAA8C,MAAKL,KAAL,CAAWwB,mBAAzD,GAA+E,GAAjH;AACA,0BAAKxB,KAAL,CAAWyB,UAAX,GAAyB,MAAKzB,KAAL,CAAWyB,UAAX,IAAyBpB,SAAzB,GAAqC,MAAKL,KAAL,CAAWyB,UAAhD,GAA6D,KAAtF;;AAEA;AACA,0BAAKtC,MAAL,CAAYuC,SAAZ,GAAwB,IAAxB;AACA,0BAAKvC,MAAL,CAAYwC,YAAZ,GAA2B,IAA3B;AACA,0BAAKxC,MAAL,CAAYyC,aAAZ,GAA4B,EAA5B;AACA,0BAAKzC,MAAL,CAAY0C,IAAZ,GAAmB,EAAnB;AAxCuC;AAyC1C;AACD;;AAEA;;;;;qDACiB;AACb,6BAAKC,YAAL,CAAkB,SAAlB,EAA6B,4EAA7B,EAA2G,CAA3G;AACA;AACH;;;sDAEiB;AACd,4BAAI,KAAKC,GAAT,EAAc;AACV,iCAAKA,GAAL,CAASC,GAAT,CAAa,SAAb;AACA,iCAAKD,GAAL,CAASC,GAAT,CAAa,SAAb;AACH;AACD;AACH;;;yDAEmB;AAChB;AACH;;;gDAEW;AACR,4BAAIC,OAAO,IAAX;;AAEA,4BAAIA,KAAKC,MAAL,GAAcD,KAAKE,GAAL,CAASD,MAA3B,EAAmCD,KAAKG,MAAL;;AAEnC;AACH;;;+CAEU;AACP,4BAAIH,OAAO,IAAX;AACAI,gCAAQC,GAAR,CAAY,SAAZ;AACH;;;+CAEU;AACP;AACH;;;mDAEcT,I,EAAM;AACjB,4BAAII,OAAO,IAAX;;AAEAA,6BAAK9C,MAAL,CAAY0C,IAAZ,GAAmBA,IAAnB;;AAEAI,6BAAKM,SAAL;;AAEAN,6BAAKO,cAAL,CAAoBX,IAApB;AACA;AACH;;;gDAEWY,G,EAAK;AACbJ,gCAAQC,GAAR,CAAY,YAAZ;AACH;;;gDAIW;AACR,4BAAIL,OAAO,IAAX;;AAEA,4BAAIA,KAAK9C,MAAL,CAAYwC,YAAZ,IAA4B,IAAhC,EAAsC;;AAElC,gCAAIe,aAAa;AACbC,6CAAa,KADA;AAEbC,oDAAoB,KAFP;AAGbC,yCAAS,KAHI;AAIbC,iDAAiB,KAJJ;AAKbC,0CAAWd,KAAKjC,KAAL,CAAWU,OAAX,IAAsB,IALpB;AAMbsC,2CAAYf,KAAKjC,KAAL,CAAWU,OAAX,IAAsB,IAAtB,GAA4B,CAA5B,GAA+B,CAN9B;AAObF,yCAAUyB,KAAKjC,KAAL,CAAWU,OAAX,IAAsB,IAAtB,GAA6BuB,KAAKjC,KAAL,CAAWQ,OAAxC,GAAkDyB,KAAKjC,KAAL,CAAWS,SAP1D;AAQbH,yCAAU2B,KAAKjC,KAAL,CAAWU,OAAX,IAAsB,IAAtB,GAA6BuB,KAAKjC,KAAL,CAAWM,OAAxC,GAAkD2B,KAAKjC,KAAL,CAAWS;AAR1D,6BAAjB;;AAWAwB,iCAAK9C,MAAL,CAAYwC,YAAZ,GAA2BsB,EAAElB,GAAF,CAAM,WAAWE,KAAKjC,KAAL,CAAWkD,EAA5B,EAAgCR,UAAhC,CAA3B;AACAT,iCAAK9C,MAAL,CAAYuC,SAAZ,GAAwBuB,EAAEvB,SAAF,CAAYzC,YAAYgD,KAAKjC,KAAL,CAAWI,aAAvB,EAAsC+C,GAAlD,EAAuDlE,YAAYgD,KAAKjC,KAAL,CAAWI,aAAvB,EAAsCG,OAA7F,CAAxB;AACA0B,iCAAK9C,MAAL,CAAYuC,SAAZ,CAAsB0B,KAAtB,CAA4BnB,KAAK9C,MAAL,CAAYwC,YAAxC;AACAM,iCAAKoB,aAAL;;AAEA;AACApB,iCAAK9C,MAAL,CAAYwC,YAAZ,CAAyBK,GAAzB,CAA6B,SAA7B;AACAC,iCAAK9C,MAAL,CAAYwC,YAAZ,CAAyBpC,EAAzB,CAA4B,SAA5B,EAAuC,UAAU+D,KAAV,EAAiB;AACpDrB,qCAAKjC,KAAL,CAAWS,SAAX,GAAuBwB,KAAK9C,MAAL,CAAYwC,YAAZ,CAAyB4B,OAAzB,EAAvB;;AAEA,oCAAIC,SAASvB,KAAK9C,MAAL,CAAYwC,YAAZ,CAAyB8B,SAAzB,EAAb;AACAxB,qCAAKjC,KAAL,CAAWW,YAAX,GAA0B6C,OAAOE,UAAP,CAAkBC,GAA5C;AACA1B,qCAAKjC,KAAL,CAAWY,WAAX,GAAyB4C,OAAOI,UAAP,CAAkBC,GAA3C;AACA5B,qCAAKjC,KAAL,CAAWa,WAAX,GAAyB2C,OAAOE,UAAP,CAAkBG,GAA3C;AACA5B,qCAAKjC,KAAL,CAAWc,YAAX,GAA0B0C,OAAOI,UAAP,CAAkBD,GAA5C;;AAEA1B,qCAAK6B,OAAL;AACH,6BAVD;AAWA7B,iCAAK9C,MAAL,CAAYwC,YAAZ,CAAyBK,GAAzB,CAA6B,SAA7B;AACAC,iCAAK9C,MAAL,CAAYwC,YAAZ,CAAyBpC,EAAzB,CAA4B,SAA5B,EAAuC,UAAU+D,KAAV,EAAiB;AACpDrB,qCAAKjC,KAAL,CAAWS,SAAX,GAAuBwB,KAAK9C,MAAL,CAAYwC,YAAZ,CAAyB4B,OAAzB,EAAvB;;AAEA,oCAAIC,SAASvB,KAAK9C,MAAL,CAAYwC,YAAZ,CAAyB8B,SAAzB,EAAb;AACAxB,qCAAKjC,KAAL,CAAWW,YAAX,GAA0B6C,OAAOE,UAAP,CAAkBC,GAA5C;AACA1B,qCAAKjC,KAAL,CAAWY,WAAX,GAAyB4C,OAAOI,UAAP,CAAkBC,GAA3C;AACA5B,qCAAKjC,KAAL,CAAWa,WAAX,GAAyB2C,OAAOE,UAAP,CAAkBG,GAA3C;AACA5B,qCAAKjC,KAAL,CAAWc,YAAX,GAA0B0C,OAAOI,UAAP,CAAkBD,GAA5C;;AAEA1B,qCAAK6B,OAAL;AACH,6BAVD;AAYH;AACJ;;;sDAEiBC,G,EAAKlC,I,EAAM;AACzB,4BAAII,OAAO,IAAX;;AAEA,4BAAI+B,SAASC,EAAEF,GAAF,EAAOG,QAAP,EAAb;AACA,4BAAIC,UAAUH,OAAO,CAAP,EAAUI,UAAV,CAAqB,IAArB,CAAd;AACAD,gCAAQE,SAAR,CAAkB,CAAlB,EAAqB,CAArB,EAAwBL,OAAOM,KAA/B,EAAsCN,OAAO9B,MAA7C;;AAEA,4BAAIqC,SAAS,EAAEC,GAAGR,OAAOM,KAAP,KAAiB,CAAtB,EAAyBG,GAAGT,OAAO9B,MAAP,KAAkB,CAA9C,EAAb;AACA,4BAAIwC,cAAczC,KAAKjC,KAAL,CAAWe,YAA7B;;AAEA,iCAAS4D,cAAT,GACA;AACIR,oCAAQS,SAAR,GAAoB,CAApB;AACAT,oCAAQU,WAAR,GAAsB,SAAtB;AACAV,oCAAQW,SAAR;AACAX,oCAAQY,GAAR,CAAYR,OAAOC,CAAnB,EAAsBD,OAAOE,CAA7B,EAAgCC,WAAhC,EAA6C,CAA7C,EAAgD,IAAIM,KAAKC,EAAzD;AACAd,oCAAQe,MAAR;AACAf,oCAAQgB,SAAR,GAAoB,SAApB;AACAhB,oCAAQiB,IAAR;AAEH;;AAED,iCAASC,QAAT,GAAoB;AAChBlB,oCAAQS,SAAR,GAAoB,CAApB;AACAT,oCAAQU,WAAR,GAAsB,MAAtB;AACA,iCAAK,IAAIS,IAAI,CAAb,EAAgBA,IAAI,EAApB,EAAwBA,GAAxB;AACIC,2CAAWb,WAAX,EAAwBY,IAAIN,KAAKC,EAAT,GAAc,CAAtC;AADJ,6BAEA,KAAK,IAAIK,IAAI,CAAb,EAAgBA,IAAI,CAApB,EAAuBA,GAAvB;AACIE,2CAAW,IAAId,WAAJ,GAAkBY,CAAlB,GAAsB,CAAjC;AADJ;AAEH;;AAED,iCAASG,WAAT,GAAuB;AACnB,gCAAIC,OAAO,CAAX;AACA,gCAAIC,OAAO,CAAX;;AAEAxB,oCAAQS,SAAR,GAAoB,CAApB;;AAEAX,8BAAE2B,IAAF,CAAOC,UAAP,EAAmB,UAAUC,GAAV,EAAeC,MAAf,EAAuB;AACtC,oCAAIA,UAAU1F,SAAd,EACI;;AAEJ,oCAAI0F,OAAOC,KAAP,IAAgB3F,SAApB,EACI;;AAEJ4D,kCAAE2B,IAAF,CAAOG,OAAOlE,IAAd,EAAoB,UAAU9C,CAAV,EAAakH,SAAb,EAAwB;AACxCF,2CAAOG,MAAP,GAAgBD,SAAhB;;AAEA,wCAAIA,UAAU,CAAV,KAAgBE,UAApB,EACI,OAAO,KAAP;AACP,iCALD;;AAOA,oCAAIL,MAAM,CAAN,IAAWC,OAAOG,MAAP,CAAc,CAAd,IAAmBR,IAAlC,EACIA,OAAOK,OAAOG,MAAP,CAAc,CAAd,CAAP;AACJ,oCAAIJ,OAAO,CAAP,IAAYC,OAAOG,MAAP,CAAc,CAAd,IAAmBP,IAAnC,EACIA,OAAOI,OAAOG,MAAP,CAAc,CAAd,CAAP;AACP,6BAlBD;;AAoBAjC,8BAAE2B,IAAF,CAAOC,UAAP,EAAmB,UAAUC,GAAV,EAAeC,MAAf,EAAuB;AACtC,oCAAIK,KAAJ;;AAEA,oCAAIL,UAAU1F,SAAd,EACI;;AAEJ,oCAAI0F,OAAOG,MAAP,IAAiB7F,SAArB,EACI;;AAEJ,oCAAIyF,MAAM,CAAV,EAAa;AACTM,4CAAQ,MAAM1B,WAAN,GAAoBgB,IAA5B;AACH,iCAFD,MAGK;AACDU,4CAAQ,MAAM1B,WAAN,GAAoBiB,IAA5B;AACAxB,4CAAQkC,WAAR,CAAoB,CAAC,EAAD,EAAK,CAAL,CAApB;AACH;;AAEDlC,wCAAQU,WAAR,GAAsBkB,OAAOC,KAA7B;AACAT,2CAAWQ,OAAOG,MAAP,CAAc,CAAd,IAAmBE,KAA9B,EAAqCL,OAAOG,MAAP,CAAc,CAAd,CAArC;AACA/B,wCAAQkC,WAAR,CAAoB,EAApB;AACH,6BApBD;AAqBH;;AAED,iCAASd,UAAT,CAAoBe,CAApB,EAAuBC,CAAvB,EAA0B;AACtB,gCAAI/B,IAAI8B,IAAItB,KAAKwB,GAAL,CAASD,CAAT,CAAZ;AACA,gCAAI9B,IAAI6B,IAAItB,KAAKyB,GAAL,CAASF,CAAT,CAAZ;;AAEApC,oCAAQS,SAAR,GAAoB,CAApB;;AAEAT,oCAAQW,SAAR;AACAX,oCAAQuC,MAAR,CAAenC,OAAOC,CAAtB,EAAyBD,OAAOE,CAAhC;AACAN,oCAAQwC,MAAR,CAAepC,OAAOC,CAAP,GAAWA,CAA1B,EAA6BD,OAAOE,CAAP,GAAWA,CAAxC;AACAN,oCAAQe,MAAR;AACH;;AAED,iCAASM,UAAT,CAAoBc,CAApB,EAAuB;AACnBnC,oCAAQS,SAAR,GAAoB,CAApB;;AAEAT,oCAAQW,SAAR;AACAX,oCAAQY,GAAR,CAAYR,OAAOC,CAAnB,EAAsBD,OAAOE,CAA7B,EAAgC6B,CAAhC,EAAmC,CAAnC,EAAsC,IAAItB,KAAKC,EAA/C;AACAd,oCAAQe,MAAR;AACH;;AAED,iCAAS0B,cAAT,CAAwBC,KAAxB,EAA+B;;AAE3BA,oCAAQA,QAAQ,EAAhB;AACA,gCAAIC,UAAUD,SAAS7B,KAAKC,EAAL,GAAU,GAAnB,CAAd;;AAEA,gCAAI8B,UAAU,EAAd,CAL2B,CAKP;AACpB,gCAAIvC,IAAIE,cAAcM,KAAKwB,GAAL,CAASM,OAAT,CAAd,GAAkCvC,OAAOC,CAAjD;AACA,gCAAIC,IAAIC,cAAcM,KAAKyB,GAAL,CAASK,OAAT,CAAd,GAAkCvC,OAAOE,CAAjD;;AAEAN,oCAAQS,SAAR,GAAoB,CAApB;AACAT,oCAAQU,WAAR,GAAsB,SAAtB;AACAV,oCAAQW,SAAR;AACAX,oCAAQuC,MAAR,CAAenC,OAAOC,CAAtB,EAAyBD,OAAOE,CAAhC;AACAN,oCAAQwC,MAAR,CAAenC,CAAf,EAAkBC,CAAlB;AACAN,oCAAQwC,MAAR,CAAenC,IAAIuC,UAAU/B,KAAKwB,GAAL,CAASM,UAAU9B,KAAKC,EAAL,GAAU,CAA7B,CAA7B,EAA8DR,IAAIsC,UAAU/B,KAAKyB,GAAL,CAASK,UAAU9B,KAAKC,EAAL,GAAQ,CAA3B,CAA5E;AACAd,oCAAQuC,MAAR,CAAelC,CAAf,EAAkBC,CAAlB;AACAN,oCAAQwC,MAAR,CAAenC,IAAIuC,UAAU/B,KAAKwB,GAAL,CAASM,UAAU9B,KAAKC,EAAL,GAAU,CAA7B,CAA7B,EAA8DR,IAAIsC,UAAU/B,KAAKyB,GAAL,CAASK,UAAU9B,KAAKC,EAAL,GAAU,CAA7B,CAA5E;AACAd,oCAAQe,MAAR;AACH;;AAED,iCAAS8B,aAAT,CAAuBC,SAAvB,EAAkC;AAC9B9C,oCAAQS,SAAR,GAAoB,CAApB;;AAEAT,oCAAQU,WAAR,GAAsB,SAAtB;AACAV,oCAAQW,SAAR;AACAX,oCAAQY,GAAR,CAAYR,OAAOC,CAAnB,EAAsBD,OAAOE,CAA7B,EAAgCC,eAAauC,YAAU,CAAvB,CAAhC,EAA2D,CAA3D,EAA8D,IAAIjC,KAAKC,EAAvE;AACAd,oCAAQe,MAAR;AACAf,oCAAQgB,SAAR,GAAoB,SAApB;AACAhB,oCAAQiB,IAAR;AAEH;;AAED,iCAAS8B,QAAT,CAAkBL,KAAlB,EAAyBb,KAAzB,EAAgC1B,KAAhC,EAAuC;AACnCH,oCAAQS,SAAR,GAAoBN,KAApB;;AAEAuC,oCAAQA,QAAQ,EAAhB;AACA,gCAAIC,UAAUD,SAAS7B,KAAKC,EAAL,GAAU,GAAnB,CAAd;;AAEA,gCAAIT,IAAIE,cAAcM,KAAKwB,GAAL,CAASM,OAAT,CAAd,GAAkCvC,OAAOC,CAAjD;AACA,gCAAIC,IAAIC,cAAcM,KAAKyB,GAAL,CAASK,OAAT,CAAd,GAAkCvC,OAAOE,CAAjD;;AAEAN,oCAAQU,WAAR,GAAsBmB,KAAtB;AACA7B,oCAAQW,SAAR;AACAX,oCAAQuC,MAAR,CAAenC,OAAOC,CAAtB,EAAyBD,OAAOE,CAAhC;AACAN,oCAAQwC,MAAR,CAAenC,CAAf,EAAkBC,CAAlB;AACAN,oCAAQe,MAAR;AACH;;AAGDP;AACAU;AACA2B,sCAAcnF,KAAKsF,QAAnB;;AAEA,4BAAGlF,KAAKjC,KAAL,CAAWmB,YAAd,EAA4B+F,SAASrF,KAAKuF,aAAd,EAA6B,SAA7B,EAAwCnF,KAAKjC,KAAL,CAAWiB,mBAAnD;AAC5B,4BAAGgB,KAAKjC,KAAL,CAAWoB,YAAd,EAA4B8F,SAASrF,KAAKwF,aAAd,EAA6B,SAA7B,EAAwCpF,KAAKjC,KAAL,CAAWkB,mBAAnD;AAC5BgG,iCAASrF,KAAKyF,UAAd,EAA0B,SAA1B,EAAqCrF,KAAKjC,KAAL,CAAWgB,gBAAhD;;AAEA;AACA;AACH;;;mDAKca,I,EAAM;AACjB,4BAAII,OAAO,IAAX;;AAEAlD,0BAAE6G,IAAF,CAAO3D,KAAK9C,MAAL,CAAYyC,aAAnB,EAAkC,UAAU2F,OAAV,EAAmBC,KAAnB,EAA0BC,IAA1B,EAAgC;AAC9DF,oCAAQG,MAAR;AACH,yBAFD;;AAIAzF,6BAAK9C,MAAL,CAAYyC,aAAZ,GAA4B,EAA5B;;AAEA7C,0BAAE6G,IAAF,CAAO/D,IAAP,EAAa,UAAU0F,OAAV,EAAmBC,KAAnB,EAA0BC,IAA1B,EAAgC;AACzC,gCAAInB,IAAIqB,SAAS1F,KAAKjC,KAAL,CAAWe,YAAX,CAAwB6G,QAAxB,EAAT,IAA+C,GAAvD;AACA,gCAAIC,UAAU5E,EAAE4E,OAAF,CAAU;AACpBC,sCAAM,oBAAoB,IAAIxB,CAAxB,GAA4B,YAA5B,GAA2C,IAAIA,CAA/C,GAAmD,mCAAnD,IAA0FA,IAAI,CAA9F,IAAmG,WAAnG,IAAkHA,IAAI,CAAtH,IAA2H,eAD7G;AAEpByB,0CAAU,CAAC,EAAD,EAAK,EAAL;AAFU,6BAAV,CAAd;AAIA,gCAAIC,SAAS/E,EAAEgF,MAAF,CAAS,CAACV,QAAQW,QAAT,EAAmBX,QAAQY,SAA3B,CAAT,EAAgD,EAAEC,MAAMP,OAAR,EAAhD,EAAmEtI,EAAnE,CAAsE,OAAtE,EAA+E,UAAU+D,KAAV,EAAiB;AACzG,oCAAI+E,QAAQC,OAAOC,IAAP,CAAY,iEAAiEC,mBAAmBjB,QAAQkB,aAA3B,CAAjE,GAA6G,iBAA7G,GAAiID,mBAAmBjB,QAAQmB,WAA3B,CAAjI,GAA2K,QAA3K,GAAsLzG,KAAK0G,SAAL,CAAeC,IAAf,CAAoBC,IAA1M,GAAiN,MAAjN,GAA0N5G,KAAK0G,SAAL,CAAeC,IAAf,CAAoBE,EAA9O,IAAoP7G,KAAK0G,SAAL,CAAe7E,OAAf,GAAyB,cAAc7B,KAAK0G,SAAL,CAAe7E,OAAtD,GAA+D,EAAnT,CAAZ,EAAoU,QAApU,CAAZ;AACH,6BAFY,CAAb;AAGA7B,iCAAK9C,MAAL,CAAYyC,aAAZ,CAA0BmH,IAA1B,CAA+Bf,MAA/B;AACAA,mCAAO5E,KAAP,CAAanB,KAAK9C,MAAL,CAAYwC,YAAzB;AACAM,iCAAK+G,iBAAL,CAAuBhB,OAAOiB,KAA9B,EAAqC1B,OAArC;;AAEA,gCAAIA,QAAQ2B,WAAR,IAAuB,EAAvB,IAA6B3B,QAAQ4B,UAAR,IAAsB,EAAvD,EAA2D;AACvD,oCAAIC,IAAJ;AACA,oCAAG7B,QAAQ8B,UAAR,IAAsB,CAAzB,EACID,OAAOnG,EAAEqG,QAAF,CAAW,CAAC,CAAC/B,QAAQW,QAAT,EAAmBX,QAAQY,SAA3B,CAAD,EAAwC,CAACZ,QAAQ4B,UAAT,EAAqB5B,QAAQ2B,WAA7B,CAAxC,CAAX,EAA+F,EAAElD,OAAO,KAAT,EAA/F,EAAiHzG,EAAjH,CAAoH,OAApH,EAA6H,UAAU+D,KAAV,EAAiB;AACjJ,wCAAI+E,QAAQC,OAAOC,IAAP,CAAY,8DAA8DC,mBAAmBjB,QAAQkB,aAA3B,CAA9D,GAA0G,cAA1G,GAA2HD,mBAAmBjB,QAAQgC,eAA3B,CAA3H,GAAyK,cAAzK,GAA0Lf,mBAAmBjB,QAAQiC,aAA3B,CAA1L,GAAsO,QAAtO,GAAiPvH,KAAK0G,SAAL,CAAeC,IAAf,CAAoBC,IAArQ,GAA4Q,MAA5Q,GAAqR5G,KAAK0G,SAAL,CAAeC,IAAf,CAAoBE,EAAzS,IAA+S7G,KAAK0G,SAAL,CAAe7E,OAAf,GAAyB,cAAc7B,KAAK0G,SAAL,CAAe7E,OAAtD,GAAgE,EAA/W,CAAZ,EAAgY,QAAhY,CAAZ;AACH,iCAFM,CAAP,CADJ,KAKIsF,OAAOnG,EAAEqG,QAAF,CAAW,CAAC,CAAC/B,QAAQ4B,UAAT,EAAqB5B,QAAQ2B,WAA7B,CAAD,EAA4C,CAAC3B,QAAQW,QAAT,EAAmBX,QAAQY,SAA3B,CAA5C,CAAX,EAA+F,EAAEnC,OAAO,KAAT,EAA/F,EAAiHzG,EAAjH,CAAoH,OAApH,EAA6H,UAAU+D,KAAV,EAAiB;AACjJ,wCAAI+E,QAAQC,OAAOC,IAAP,CAAY,8DAA8DC,mBAAmBjB,QAAQkB,aAA3B,CAA9D,GAA0G,cAA1G,GAA2HD,mBAAmBjB,QAAQgC,eAA3B,CAA3H,GAAyK,cAAzK,GAA0Lf,mBAAmBjB,QAAQiC,aAA3B,CAA1L,GAAsO,QAAtO,GAAiPvH,KAAK0G,SAAL,CAAeC,IAAf,CAAoBC,IAArQ,GAA4Q,MAA5Q,GAAqR5G,KAAK0G,SAAL,CAAeC,IAAf,CAAoBE,EAAzS,IAA+S7G,KAAK0G,SAAL,CAAe7E,OAAf,GAAyB,cAAc7B,KAAK0G,SAAL,CAAe7E,OAAtD,GAAgE,EAA/W,CAAZ,EAAgY,QAAhY,CAAZ;AACH,iCAFM,CAAP;;AAIJ,oCAAI2F,YAAYxG,EAAEyG,iBAAF,CAAoBN,IAApB,EAA0B;AACtCO,8CAAU,CACN,EAAEC,QAAQ,KAAV,EAAiBC,QAAQ,CAAzB,EAA4BC,QAAQ7G,EAAE8G,MAAF,CAASC,SAAT,CAAmB,EAAEC,WAAW,EAAb,EAAiBC,aAAa,EAAElE,OAAO,KAAT,EAAgBmE,aAAa,CAA7B,EAAgCC,QAAQ,CAAxC,EAA9B,EAAnB,CAApC,EADM;AAD4B,iCAA1B,CAAhB;;AAMAnI,qCAAK9C,MAAL,CAAYyC,aAAZ,CAA0BmH,IAA1B,CAA+BK,IAA/B;AACAnH,qCAAK9C,MAAL,CAAYyC,aAAZ,CAA0BmH,IAA1B,CAA+BU,SAA/B;;AAEAL,qCAAKhG,KAAL,CAAWnB,KAAK9C,MAAL,CAAYwC,YAAvB;AACA8H,0CAAUrG,KAAV,CAAgBnB,KAAK9C,MAAL,CAAYwC,YAA5B;AACH;AACJ,yBApCD;AAsCH;;;0DAKqB;AAClB,4BAAIM,OAAO,IAAX;;AAEAA,6BAAK9C,MAAL,CAAYuC,SAAZ,CAAsBgG,MAAtB;AACAzF,6BAAK9C,MAAL,CAAYuC,SAAZ,GAAwBuB,EAAEvB,SAAF,CAAYzC,YAAY,KAAKe,KAAL,CAAWI,aAAvB,EAAsC+C,GAAlD,EAAuDlE,YAAY,KAAKe,KAAL,CAAWI,aAAvB,EAAsCG,OAA7F,CAAxB;AACA0B,6BAAK9C,MAAL,CAAYuC,SAAZ,CAAsB0B,KAAtB,CAA4B,KAAKjE,MAAL,CAAYwC,YAAxC;AACH;;;iDAEY;AACT,4BAAIM,OAAO,IAAX;;AAEAA,6BAAK9C,MAAL,CAAYwC,YAAZ,CAAyBpB,OAAzB,CAAiCC,OAAjC,GAA4CyB,KAAKjC,KAAL,CAAWU,OAAX,IAAsB,IAAtB,GAA6BuB,KAAKjC,KAAL,CAAWQ,OAAxC,GAAkDyB,KAAKjC,KAAL,CAAWS,SAAzG;AACAwB,6BAAK9C,MAAL,CAAYwC,YAAZ,CAAyBpB,OAAzB,CAAiCD,OAAjC,GAA4C2B,KAAKjC,KAAL,CAAWU,OAAX,IAAsB,IAAtB,GAA6BuB,KAAKjC,KAAL,CAAWM,OAAxC,GAAkD2B,KAAKjC,KAAL,CAAWS,SAAzG;;AAEAwB,6BAAK9C,MAAL,CAAYwC,YAAZ,CAAyB0I,OAAzB,CAAiCpI,KAAKjC,KAAL,CAAWS,SAA5C;AACH;;;oDAEe;AACZ,4BAAIwB,OAAO,IAAX;;AAEAA,6BAAK9C,MAAL,CAAYwC,YAAZ,CAAyB2I,SAAzB,CAAmC,CAC/B,CAACrI,KAAKjC,KAAL,CAAWY,WAAZ,EAAyBqB,KAAKjC,KAAL,CAAWW,YAApC,CAD+B,EAE/B,CAACsB,KAAKjC,KAAL,CAAWa,WAAZ,EAAyBoB,KAAKjC,KAAL,CAAWc,YAApC,CAF+B,CAAnC;AAIH;;;8CAES;AACN,4BAAImB,OAAO,IAAX;;AAEAA,6BAAK9C,MAAL,CAAYwC,YAAZ,CAAyB+F,MAAzB;AACAzF,6BAAK9C,MAAL,CAAYwC,YAAZ,GAA2B,IAA3B;AACAM,6BAAKM,SAAL;AACH;;;qDAEgB;AACb,4BAAIN,OAAO,IAAX;;AAEA,4BAAIsI,cAAc,IAAItH,EAAEuH,YAAN,CAAmBvI,KAAK9C,MAAL,CAAYyC,aAA/B,CAAlB;AACA,4BAAI2I,YAAY9G,SAAZ,GAAwBgH,OAAxB,EAAJ,EACIxI,KAAK9C,MAAL,CAAYwC,YAAZ,CAAyB2I,SAAzB,CAAmCC,YAAY9G,SAAZ,EAAnC;;AAEJ,4BAAID,SAASvB,KAAK9C,MAAL,CAAYwC,YAAZ,CAAyB8B,SAAzB,EAAb;AACAxB,6BAAKjC,KAAL,CAAWW,YAAX,GAA0B6C,OAAOE,UAAP,CAAkBC,GAA5C;AACA1B,6BAAKjC,KAAL,CAAWY,WAAX,GAAyB4C,OAAOI,UAAP,CAAkBC,GAA3C;AACA5B,6BAAKjC,KAAL,CAAWa,WAAX,GAAyB2C,OAAOE,UAAP,CAAkBG,GAA3C;AACA5B,6BAAKjC,KAAL,CAAWc,YAAX,GAA0B0C,OAAOI,UAAP,CAAkBD,GAA5C;AACH;;;6CAIQ+G,G,EAAKC,G,EAAKC,I,EAAM;AACrBA,+BAAOA,QAAQ,CAAf;AACA,4BAAIC,QAAQ,EAAZ;AACA,6BAAK,IAAIvF,IAAIoF,GAAb,EAAkBpF,KAAKqF,GAAvB,EAA4BrF,KAAKsF,IAAjC,EAAuC;AACnCC,kCAAM9B,IAAN,CAAWzD,CAAX;AACH;AACD,+BAAOuF,KAAP;AACH;;;6CAGQhE,K,EAAO;AACZ,4BAAIA,QAAQ,CAAC,GAAT,IAAgBA,SAAS,GAA7B,EAAkC,OAAOA,KAAP,CAAlC,KACK,IAAIA,SAAS,CAAC,GAAd,EAAmB,OAAO,MAAMA,KAAb,CAAnB,KACA,IAAIA,QAAQ,GAAZ,EAAiB,OAAOA,QAAQ,GAAf;AACzB;;;;cA5a8B/H,gB;;;;AA+anCI,0BAAc4L,WAAd,GAA4B,sBAA5B","file":"phasorMap_ctrl.js","sourcesContent":["﻿//******************************************************************************************************\r\n//  phasorMap_ctrl.js - Gbtc\r\n//\r\n//  Copyright © 2017, Grid Protection Alliance.  All Rights Reserved.\r\n//\r\n//  Licensed to the Grid Protection Alliance (GPA) under one or more contributor license agreements. See\r\n//  the NOTICE file distributed with this work for additional information regarding copyright ownership.\r\n//  The GPA licenses this file to you under the MIT License (MIT), the \"License\"; you may not use this\r\n//  file except in compliance with the License. You may obtain a copy of the License at:\r\n//\r\n//      http://opensource.org/licenses/MIT\r\n//\r\n//  Unless agreed to in writing, the subject software distributed under the License is distributed on an\r\n//  \"AS-IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. Refer to the\r\n//  License for the specific language governing permissions and limitations.\r\n//\r\n//  Code Modification History:\r\n//  ----------------------------------------------------------------------------------------------------\r\n//  10/23/2017 - Billy Ernest\r\n//       Generated original version of source code.\r\n//\r\n//******************************************************************************************************\r\n\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk'\r\n//import * as L from '../lib/leaflet';\r\n//import * as pD from '../lib/leaflet.polylineDecorator.js';\r\nimport _ from 'lodash';\nimport moment from 'moment';\nimport '../css/leaflet.css!';\nimport { TileServers } from './../js/constants';\n\nexport class PhasorMapCtrl extends MetricsPanelCtrl{\r\n    // #region Constructor\r\n    constructor($scope, $injector, $rootScope) {\r\n        super($scope, $injector);\r\n\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n        this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\r\n        this.events.on('render', this.onRender.bind(this));\r\n        this.events.on('panel-initialized', this.onPanelInitialized.bind(this));\r\n        this.events.on('data-received', this.onDataRecieved.bind(this));\r\n        //this.events.on('data-snapshot-load', console.log('data-snapshot-load'));\r\n        this.events.on('data-error', this.onDataError.bind(this));\r\n        this.events.on('refresh', this.onRefresh.bind(this));\n        \r\n        // Variables for options\r\n        this.panel.mapBackgrounds = Object.keys(TileServers);\r\n        this.panel.mapBackground  = (this.panel.mapBackground != undefined ? this.panel.mapBackground : this.panel.mapBackgrounds[0]);\r\n        this.panel.maxZoom        = TileServers[this.panel.mapBackground].options.maxZoom;\r\n        this.panel.minZoom =        (TileServers[this.panel.mapBackground].options.minZoom != undefined ? TileServers[this.panel.mapBackground].options.minZoom : 2)\r\n        this.panel.zoomLevel =      (this.panel.zoomLevel       != undefined ? this.panel.zoomLevel     : TileServers[this.panel.mapBackground].options.maxZoom);\r\n        this.panel.lockMap =        (this.panel.lockMap         != undefined ? this.panel.lockMap       : 'No'  );\r\n        this.panel.maxLongitude =   (this.panel.maxLongitude    != undefined ? this.panel.maxLongitude  : -125  );\r\n        this.panel.maxLatitude =    (this.panel.maxLatitude     != undefined ? this.panel.maxLatitude   : 24    );\r\n        this.panel.minLatitude =    (this.panel.minLatitude     != undefined ? this.panel.minLatitude   : 50    );\r\n        this.panel.minLongitude =   (this.panel.minLongitude    != undefined ? this.panel.minLongitude  : -66   );\r\n        this.panel.circleRadius = (this.panel.circleRadius != undefined ? this.panel.circleRadius : 50);\r\n        this.panel.angleMarkerWidth = (this.panel.angleMarkerWidth != undefined ? this.panel.angleMarkerWidth : 5);  \r\n        this.panel.minAngleMarkerWidth = (this.panel.minAngleMarkerWidth != undefined ? this.panel.minAngleMarkerWidth : 1);  \r\n        this.panel.maxAngleMarkerWidth = (this.panel.maxAngleMarkerWidth != undefined ? this.panel.maxAngleMarkerWidth : 1);  \r\n        this.panel.showMinAngle = (this.panel.showMinAngle != undefined ? this.panel.showMinAngle : true);\r\n        this.panel.showMaxAngle = (this.panel.showMaxAngle != undefined ? this.panel.showMaxAngle : true);\r\n\r\n        this.panel.useReferenceValue = (this.panel.useReferenceValue != undefined ? this.panel.useReferenceValue : false);\r\n        this.panel.referencePointTag = (this.panel.referencePointTag != undefined ? this.panel.referencePointTag : '');  \r\n        this.panel.useAngleMean = (this.panel.useAngleMean != undefined ? this.panel.useAngleMean : false);\r\n        this.panel.angleMeanTimeWindow = (this.panel.angleMeanTimeWindow != undefined ? this.panel.angleMeanTimeWindow : '5');\r\n        this.panel.showLegend = (this.panel.showLegend != undefined ? this.panel.showLegend : false);\r\n\r\n        // Scope Variables\r\n        this.$scope.tileLayer = null;\r\n        this.$scope.mapContainer = null;\r\n        this.$scope.circleMarkers = [];\r\n        this.$scope.data = [];\r\n    }\r\n    // #endregion\r\n\r\n    // #region Events from Graphana Handlers\r\n    onInitEditMode() {\r\n        this.addEditorTab('Options', 'public/plugins/gridprotectionalliance-phasormap-panel/partials/editor.html', 2);\n        //console.log('init-edit-mode');\r\n    }\r\n\r\n    onPanelTeardown() {\r\n        if (this.map) {\r\n            this.map.off('zoomend');\r\n            this.map.off('moveend');\r\n        }\r\n        //console.log('panel-teardown');\r\n    }\r\n\r\n    onPanelInitialized(){\r\n        //console.log('panel-initialized');\r\n    }\r\n\r\n    onRefresh() {\n        var ctrl = this;\n\n        if (ctrl.height > ctrl.row.height) ctrl.render();\n\n        //console.log('refresh');\r\n    }\n\n    onResize() {\n        var ctrl = this;\n        console.log('refresh');\r\n    }\n\n    onRender() {\n        //console.log('render');\r\n    }\n\n    onDataRecieved(data) {\n        var ctrl = this;\n\n        ctrl.$scope.data = data;\n\n        ctrl.createMap();\n\n        ctrl.plotPhasorData(data);\n        //console.log('data-recieved');\r\n    }\n\n    onDataError(msg) {\n        console.log('data-error');\r\n    }\n    // #endregion\n\r\n    // #region Map and Marker Creation\r\n    createMap() {\r\n        var ctrl = this;\r\n\r\n        if (ctrl.$scope.mapContainer == null) {\r\n\r\n            var mapOptions = {\r\n                zoomControl: false,\r\n                attributionControl: false,\r\n                boxZoom: false,\r\n                doubleClickZoom: false,\r\n                dragging: (ctrl.panel.lockMap == 'No'),\r\n                zoomDelta: (ctrl.panel.lockMap == 'No'? 1: 0),\r\n                minZoom: (ctrl.panel.lockMap == 'No' ? ctrl.panel.minZoom : ctrl.panel.zoomLevel),\r\n                maxZoom: (ctrl.panel.lockMap == 'No' ? ctrl.panel.maxZoom : ctrl.panel.zoomLevel)\r\n            };\r\n\r\n            ctrl.$scope.mapContainer = L.map('mapid_' + ctrl.panel.id, mapOptions);\r\n            ctrl.$scope.tileLayer = L.tileLayer(TileServers[ctrl.panel.mapBackground].url, TileServers[ctrl.panel.mapBackground].options);\r\n            ctrl.$scope.tileLayer.addTo(ctrl.$scope.mapContainer);\r\n            ctrl.updateMapView();\r\n\r\n            // setup map listeners\r\n            ctrl.$scope.mapContainer.off('zoomend');\r\n            ctrl.$scope.mapContainer.on('zoomend', function (event) {\r\n                ctrl.panel.zoomLevel = ctrl.$scope.mapContainer.getZoom();\r\n\r\n                var bounds = ctrl.$scope.mapContainer.getBounds();\r\n                ctrl.panel.maxLongitude = bounds._southWest.lng;\r\n                ctrl.panel.maxLatitude = bounds._northEast.lat;\r\n                ctrl.panel.minLatitude = bounds._southWest.lat;\r\n                ctrl.panel.minLongitude = bounds._northEast.lng;\r\n\r\n                ctrl.refresh();\r\n            });\r\n            ctrl.$scope.mapContainer.off('moveend');\r\n            ctrl.$scope.mapContainer.on('moveend', function (event) {\r\n                ctrl.panel.zoomLevel = ctrl.$scope.mapContainer.getZoom();\r\n\r\n                var bounds = ctrl.$scope.mapContainer.getBounds();\r\n                ctrl.panel.maxLongitude = bounds._southWest.lng;\r\n                ctrl.panel.maxLatitude = bounds._northEast.lat;\r\n                ctrl.panel.minLatitude = bounds._southWest.lat;\r\n                ctrl.panel.minLongitude = bounds._northEast.lng;\r\n\r\n                ctrl.refresh();\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    updatePhasorChart(div, data) {\r\n        var ctrl = this;\r\n\r\n        var canvas = $(div).children();\r\n        var context = canvas[0].getContext(\"2d\");\r\n        context.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n        var center = { x: canvas.width() / 2, y: canvas.height() / 2 };\r\n        var chartRadius = ctrl.panel.circleRadius;\r\n\r\n        function drawBackground()\r\n        {\r\n            context.lineWidth = 1;\r\n            context.strokeStyle = \"#000000\";\r\n            context.beginPath();\r\n            context.arc(center.x, center.y, chartRadius, 0, 2 * Math.PI);\r\n            context.stroke();\r\n            context.fillStyle = \"#FFFFFF\";\r\n            context.fill();\r\n\r\n        }\r\n\r\n        function drawGrid() {\r\n            context.lineWidth = 1;\r\n            context.strokeStyle = \"#DDD\";\r\n            for (var i = 0; i < 18; i++)\r\n                drawVector(chartRadius, i * Math.PI / 9);\r\n            for (var i = 1; i < 8; i++)\r\n                drawCircle(1 * chartRadius * i / 8);\r\n        }\r\n\r\n        function drawPhasors() {\r\n            var vMax = 0;\r\n            var iMax = 0;\r\n\r\n            context.lineWidth = 3;\r\n\r\n            $.each(phasorData, function (key, series) {\r\n                if (series == undefined)\r\n                    return;\r\n\r\n                if (series.color == undefined)\r\n                    return;\r\n\r\n                $.each(series.data, function (_, dataPoint) {\r\n                    series.vector = dataPoint;\r\n\r\n                    if (dataPoint[0] >= xaxisHover)\r\n                        return false;\r\n                });\r\n\r\n                if (key < 3 && series.vector[1] > vMax)\r\n                    vMax = series.vector[1];\r\n                if (key >= 3 && series.vector[1] > iMax)\r\n                    iMax = series.vector[1];\r\n            });\r\n\r\n            $.each(phasorData, function (key, series) {\r\n                var scale;\r\n\r\n                if (series == undefined)\r\n                    return;\r\n\r\n                if (series.vector == undefined)\r\n                    return;\r\n\r\n                if (key < 3) {\r\n                    scale = 0.9 * chartRadius / vMax;\r\n                }\r\n                else {\r\n                    scale = 0.9 * chartRadius / iMax;\r\n                    context.setLineDash([10, 5]);\r\n                }\r\n\r\n                context.strokeStyle = series.color;\r\n                drawVector(series.vector[1] * scale, series.vector[2]);\r\n                context.setLineDash([]);\r\n            });\r\n        }\r\n\r\n        function drawVector(r, t) {\r\n            var x = r * Math.cos(t);\r\n            var y = r * Math.sin(t);\r\n\r\n            context.lineWidth = 1;\r\n\r\n            context.beginPath();\r\n            context.moveTo(center.x, center.y);\r\n            context.lineTo(center.x + x, center.y - y);\r\n            context.stroke();\r\n        }\r\n\r\n        function drawCircle(r) {\r\n            context.lineWidth = 1;\r\n\r\n            context.beginPath();\r\n            context.arc(center.x, center.y, r, 0, 2 * Math.PI);\r\n            context.stroke();\r\n        }\r\n\r\n        function drawAngleArrow(angle) {\r\n\r\n            angle = angle - 90;\r\n            var radians = angle * (Math.PI / 180);\r\n\r\n            var headlen = 10;   // length of head in pixels\r\n            var x = chartRadius * Math.cos(radians) + center.x;\r\n            var y = chartRadius * Math.sin(radians) + center.y;\r\n\r\n            context.lineWidth = 5;\r\n            context.strokeStyle = \"#000000\";\r\n            context.beginPath();\r\n            context.moveTo(center.x, center.y);\r\n            context.lineTo(x, y);\r\n            context.lineTo(x - headlen * Math.cos(radians - Math.PI / 6), y - headlen * Math.sin(radians - Math.PI/6));\r\n            context.moveTo(x, y);\r\n            context.lineTo(x - headlen * Math.cos(radians + Math.PI / 6), y - headlen * Math.sin(radians + Math.PI / 6));\r\n            context.stroke();\r\n        }\r\n\r\n        function drawMagCircle(magnitude) {\r\n            context.lineWidth = 1;\r\n\r\n            context.strokeStyle = \"#FFFF00\";\r\n            context.beginPath();\r\n            context.arc(center.x, center.y, chartRadius*(magnitude/2), 0, 2 * Math.PI);\r\n            context.stroke();\r\n            context.fillStyle = \"#FFFF00\";\r\n            context.fill();\r\n\r\n        }\r\n\r\n        function drawLine(angle, color, width) {\r\n            context.lineWidth = width;\r\n\r\n            angle = angle - 90;\r\n            var radians = angle * (Math.PI / 180);\r\n\r\n            var x = chartRadius * Math.cos(radians) + center.x;\r\n            var y = chartRadius * Math.sin(radians) + center.y;\r\n\r\n            context.strokeStyle = color;\r\n            context.beginPath();\r\n            context.moveTo(center.x, center.y);\r\n            context.lineTo(x, y);\r\n            context.stroke();\r\n        }\r\n\r\n\r\n        drawBackground();\r\n        drawGrid();\r\n        drawMagCircle(data.magvalue);\r\n\r\n        if(ctrl.panel.showMinAngle) drawLine(data.minanglevalue, \"#FF0000\", ctrl.panel.minAngleMarkerWidth);\r\n        if(ctrl.panel.showMaxAngle) drawLine(data.maxanglevalue, \"#FF0000\", ctrl.panel.maxAngleMarkerWidth);\r\n        drawLine(data.anglevalue, \"#000000\", ctrl.panel.angleMarkerWidth);\r\n\r\n        //if (phasor.angleMean)\r\n        //    drawAverageLine(phasor.angleMean);\r\n    }\r\n\r\n    // #endregion\r\n\r\n    // #region Data\r\n    plotPhasorData(data) {\r\n        var ctrl = this;\r\n\r\n        _.each(ctrl.$scope.circleMarkers, function (element, index, list) {\r\n            element.remove();\r\n        });\r\n\r\n        ctrl.$scope.circleMarkers = [];\r\n\r\n        _.each(data, function (element, index, list) {\r\n            var r = parseInt(ctrl.panel.circleRadius.toString()) * 1.2;\r\n            var divIcon = L.divIcon({\r\n                html: '<canvas width=\"' + 2 * r + '\" height=\"' + 2 * r + '\" style=\"position:relative; top:-' + (r - 5) + 'px;left:-' + (r - 5) + 'px\"></canvas>',\r\n                iconSize: [12, 12]\r\n            });\r\n            var circle = L.marker([element.latitude, element.longitude], { icon: divIcon }).on('click', function (event) {\r\n                var popup = window.open(\"http://localhost:3000/dashboard/db/templatephasor?var-Angle=\" + encodeURIComponent(element.anglepointtag) + \"&var-Magnitude=\" + encodeURIComponent(element.magpointtag) + \"&from=\" + ctrl.dashboard.time.from + \"&to=\" + ctrl.dashboard.time.to + (ctrl.dashboard.refresh ? \"&refresh=\" + ctrl.dashboard.refresh: \"\"), \"_blank\");\r\n            });\r\n            ctrl.$scope.circleMarkers.push(circle);\r\n            circle.addTo(ctrl.$scope.mapContainer);\r\n            ctrl.updatePhasorChart(circle._icon, element);\r\n\r\n            if (element.tolongitude != \"\" && element.tolatitude != \"\") {\r\n                var line;\r\n                if(element.powervalue >= 0)\r\n                    line = L.polyline([[element.latitude, element.longitude], [element.tolatitude, element.tolongitude]], { color: 'red' }).on('click', function (event) {\r\n                        var popup = window.open(\"http://localhost:3000/dashboard/db/templating?var-AngleA=\" + encodeURIComponent(element.anglepointtag) + \"&var-AngleB=\" + encodeURIComponent(element.toanglepointtag) + \"&var-LineMW=\" + encodeURIComponent(element.powerpointtag) + \"&from=\" + ctrl.dashboard.time.from + \"&to=\" + ctrl.dashboard.time.to + (ctrl.dashboard.refresh ? \"&refresh=\" + ctrl.dashboard.refresh : \"\"), \"_blank\");\r\n                    });\r\n                else\r\n                    line = L.polyline([[element.tolatitude, element.tolongitude], [element.latitude, element.longitude]], { color: 'red' }).on('click', function (event) {\r\n                        var popup = window.open(\"http://localhost:3000/dashboard/db/templating?var-AngleA=\" + encodeURIComponent(element.anglepointtag) + \"&var-AngleB=\" + encodeURIComponent(element.toanglepointtag) + \"&var-LineMW=\" + encodeURIComponent(element.powerpointtag) + \"&from=\" + ctrl.dashboard.time.from + \"&to=\" + ctrl.dashboard.time.to + (ctrl.dashboard.refresh ? \"&refresh=\" + ctrl.dashboard.refresh : \"\"), \"_blank\");\r\n                    });\r\n\r\n                var decorator = L.polylineDecorator(line, {\r\n                    patterns: [\r\n                        { offset: '60%', repeat: 0, symbol: L.Symbol.arrowHead({ pixelSize: 15, pathOptions: { color: 'red', fillOpacity: 1, weight: 0 } }) }\r\n                    ]\r\n                });\r\n\r\n                ctrl.$scope.circleMarkers.push(line);\r\n                ctrl.$scope.circleMarkers.push(decorator);\r\n\r\n                line.addTo(ctrl.$scope.mapContainer);\r\n                decorator.addTo(ctrl.$scope.mapContainer);\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    // #endregion\r\n\r\n    // #region Options Functions\r\n    changeMapBackground() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.tileLayer.remove();\r\n        ctrl.$scope.tileLayer = L.tileLayer(TileServers[this.panel.mapBackground].url, TileServers[this.panel.mapBackground].options);\r\n        ctrl.$scope.tileLayer.addTo(this.$scope.mapContainer);\r\n    }\r\n\r\n    updateZoom() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.mapContainer.options.minZoom = (ctrl.panel.lockMap == 'No' ? ctrl.panel.minZoom : ctrl.panel.zoomLevel);\r\n        ctrl.$scope.mapContainer.options.maxZoom = (ctrl.panel.lockMap == 'No' ? ctrl.panel.maxZoom : ctrl.panel.zoomLevel);\r\n\r\n        ctrl.$scope.mapContainer.setZoom(ctrl.panel.zoomLevel);\r\n    }\r\n\r\n    updateMapView() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.mapContainer.fitBounds([\r\n            [ctrl.panel.maxLatitude, ctrl.panel.maxLongitude],\r\n            [ctrl.panel.minLatitude, ctrl.panel.minLongitude]\r\n        ]);\r\n    }\r\n\r\n    lockMap() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.mapContainer.remove();\r\n        ctrl.$scope.mapContainer = null;\r\n        ctrl.createMap();\r\n    }\r\n\r\n    boundToMarkers() {\r\n        var ctrl = this;\r\n\r\n        var markerGroup = new L.featureGroup(ctrl.$scope.circleMarkers);\r\n        if (markerGroup.getBounds().isValid())\r\n            ctrl.$scope.mapContainer.fitBounds(markerGroup.getBounds());\r\n\r\n        var bounds = ctrl.$scope.mapContainer.getBounds();\r\n        ctrl.panel.maxLongitude = bounds._southWest.lng;\r\n        ctrl.panel.maxLatitude = bounds._northEast.lat;\r\n        ctrl.panel.minLatitude = bounds._southWest.lat;\r\n        ctrl.panel.minLongitude = bounds._northEast.lng;\r\n    }\r\n    //#endregion\r\n\r\n    // #region Angular Tag Functions\r\n    getRange(min, max, step) {\r\n        step = step || 1;\r\n        var input = [];\r\n        for (var i = min; i <= max; i += step) {\r\n            input.push(i);\r\n        }\r\n        return input;\r\n    }\r\n    // #endregion\r\n\r\n    fixAngle(angle) {\r\n        if (angle > -180 && angle <= 180) return angle;\r\n        else if (angle <= -180) return 360 + angle;\r\n        else if (angle > 180) return angle - 360;\r\n    }\r\n}\r\n\r\nPhasorMapCtrl.templateUrl = 'partials/module.html';\r\n"]}