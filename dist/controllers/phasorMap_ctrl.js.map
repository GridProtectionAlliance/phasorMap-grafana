{"version":3,"sources":["../../src/controllers/phasorMap_ctrl.js"],"names":["MetricsPanelCtrl","L","_","moment","tileServers","url","options","maxZoom","attribution","subdomains","PhasorMapCtrl","$scope","$injector","$rootScope","events","on","onInitEditMode","bind","onPanelTeardown","onRender","onPanelInitialized","onDataRecieved","onDataError","onRefresh","panel","mapBackgrounds","Object","keys","mapBackground","undefined","minZoom","zoomLevel","lockMap","maxLongitude","maxLatitude","minLatitude","minLongitude","circleRadius","useReferenceValue","referencePointTag","useAngleMean","angleMeanTimeWindow","tileLayer","mapContainer","metaData","magTags","angleTags","powerTags","phasorPairs","circleMarkers","addEditorTab","map","off","ctrl","height","row","render","console","log","data","createMap","editMode","getMetadata","updateData","msg","mapOptions","zoomControl","attributionControl","boxZoom","doubleClickZoom","dragging","zoomDelta","id","addTo","updateMapView","event","getZoom","bounds","getBounds","_southWest","lng","_northEast","lat","refresh","each","element","index","list","remove","r","parseInt","toString","divIcon","html","iconSize","circle","marker","Latitude","Longitude","icon","push","_icon","updatePhasorChart","phasorId","phasor","canvas","$","children","context","getContext","clearRect","width","center","x","y","chartRadius","drawBackground","strokeStyle","beginPath","arc","Math","PI","stroke","fillStyle","fill","drawGrid","lineWidth","i","drawVector","drawCircle","drawPhasors","vMax","iMax","phasorData","key","series","color","dataPoint","vector","xaxisHover","scale","setLineDash","t","cos","sin","moveTo","lineTo","drawAngleArrow","angle","radians","headlen","drawMagCircle","magnitude","drawAverageLine","MagnitudeValue","AngleValue","angleMean","datasource","getMetaData","pointtag","join","then","d","JSON","parse","PhasorID","hasOwnProperty","PhasorType","SignalType","indexOf","MagnitudeTag","PointTag","AngleTag","plotMetaData","refpoints","refAngle","tag","find","o","datapoints","length","timeWindow","lastTime","firstTime","filter","v","anglepoints","e","j","l","mean","setZoom","fitBounds","markerGroup","featureGroup","isValid","min","max","step","input","templateUrl"],"mappings":"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","file":"phasorMap_ctrl.js","sourcesContent":["﻿//******************************************************************************************************\r\n//  phasorMap_ctrl.js - Gbtc\r\n//\r\n//  Copyright © 2017, Grid Protection Alliance.  All Rights Reserved.\r\n//\r\n//  Licensed to the Grid Protection Alliance (GPA) under one or more contributor license agreements. See\r\n//  the NOTICE file distributed with this work for additional information regarding copyright ownership.\r\n//  The GPA licenses this file to you under the MIT License (MIT), the \"License\"; you may not use this\r\n//  file except in compliance with the License. You may obtain a copy of the License at:\r\n//\r\n//      http://opensource.org/licenses/MIT\r\n//\r\n//  Unless agreed to in writing, the subject software distributed under the License is distributed on an\r\n//  \"AS-IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. Refer to the\r\n//  License for the specific language governing permissions and limitations.\r\n//\r\n//  Code Modification History:\r\n//  ----------------------------------------------------------------------------------------------------\r\n//  10/23/2017 - Billy Ernest\r\n//       Generated original version of source code.\r\n//\r\n//******************************************************************************************************\r\n\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk'\r\nimport * as L from '../lib/leaflet';\r\nimport _ from 'lodash';\nimport moment from 'moment';\nimport '../css/leaflet.css!';\n\n// #region Constant Variables\nconst tileServers = {\r\n    'Mapnik': { url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', options: { maxZoom: 19, attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy;' } },\r\n    'Black and White': { url: 'http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', options: { maxZoom: 18, attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy;' } },\r\n    'DE': { url: 'https://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png', options: { maxZoom: 18, attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy;' } },\r\n    'France': { url: 'https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', options: { maxZoom: 20, attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy;' } },\r\n    'HOT': { url: 'https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', options: { maxZoom: 19, attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy;' } },\r\n    'OpenTopoMap': { url: 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', options: { maxZoom: 17, attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy;' } },\r\n    'Grayscale': { url: 'https://korona.geog.uni-heidelberg.de/tiles/roadsg/x={x}&y={y}&z={z}', options: { maxZoom: 19, attribution: 'Imagery from <a href=\"http://giscience.uni-hd.de/\">GIScience Research Group @ University of Heidelberg</a> &mdash; Map data &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>' } },\r\n    'Positron': { url: 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', options: { maxZoom: 19, attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy;', subdomains: 'abcd' } },\r\n    'DarkMatter': { url: 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', options: { maxZoom: 19, attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy;', subdomains: 'abcd' } },\r\n\r\n};\r\n// #endregion\r\n\r\nexport class PhasorMapCtrl extends MetricsPanelCtrl{\r\n    // #region Constructor\r\n    constructor($scope, $injector, $rootScope) {\r\n        super($scope, $injector);\r\n\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n        this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\r\n        this.events.on('render', this.onRender.bind(this));\r\n        this.events.on('panel-initialized', this.onPanelInitialized.bind(this));\r\n        this.events.on('data-received', this.onDataRecieved.bind(this));\r\n        //this.events.on('data-snapshot-load', console.log('data-snapshot-load'));\r\n        this.events.on('data-error', this.onDataError.bind(this));\r\n        this.events.on('refresh', this.onRefresh.bind(this));\n        \r\n        // Variables for options\r\n        this.panel.mapBackgrounds = Object.keys(tileServers);\r\n        this.panel.mapBackground  = (this.panel.mapBackground != undefined ? this.panel.mapBackground : this.panel.mapBackgrounds[0]);\r\n        this.panel.maxZoom        = tileServers[this.panel.mapBackground].options.maxZoom;\r\n        this.panel.minZoom =        (tileServers[this.panel.mapBackground].options.minZoom != undefined ? tileServers[this.panel.mapBackground].options.minZoom : 2)\r\n        this.panel.zoomLevel =      (this.panel.zoomLevel       != undefined ? this.panel.zoomLevel     : tileServers[this.panel.mapBackground].options.maxZoom);\r\n        this.panel.lockMap =        (this.panel.lockMap         != undefined ? this.panel.lockMap       : 'No'  );\r\n        this.panel.maxLongitude =   (this.panel.maxLongitude    != undefined ? this.panel.maxLongitude  : -125  );\r\n        this.panel.maxLatitude =    (this.panel.maxLatitude     != undefined ? this.panel.maxLatitude   : 24    );\r\n        this.panel.minLatitude =    (this.panel.minLatitude     != undefined ? this.panel.minLatitude   : 50    );\r\n        this.panel.minLongitude =   (this.panel.minLongitude    != undefined ? this.panel.minLongitude  : -66   );\r\n        this.panel.circleRadius =   (this.panel.circleRadius    != undefined ? this.panel.circleRadius  : 50    );  \r\n        this.panel.useReferenceValue = (this.panel.useReferenceValue != undefined ? this.panel.useReferenceValue : false);\r\n        this.panel.referencePointTag = (this.panel.referencePointTag != undefined ? this.panel.referencePointTag : '');  \r\n        this.panel.useAngleMean = (this.panel.useAngleMean != undefined ? this.panel.useAngleMean : false);\r\n        this.panel.angleMeanTimeWindow = (this.panel.angleMeanTimeWindow != undefined ? this.panel.angleMeanTimeWindow : '5');\r\n\r\n        // Scope Variables\r\n        this.$scope.tileLayer = null;\r\n        this.$scope.mapContainer = null;\r\n        this.$scope.metaData = null;\r\n        this.$scope.magTags = [];\r\n        this.$scope.angleTags = [];\r\n        this.$scope.powerTags = [];\r\n        this.$scope.phasorPairs = {};\r\n        this.$scope.circleMarkers = [];\r\n    }\r\n    // #endregion\r\n\r\n    // #region Events from Graphana Handlers\r\n    onInitEditMode() {\r\n        this.addEditorTab('Options', 'public/plugins/gridprotectionalliance-phasormap-panel/partials/editor.html', 2);\n        this.addEditorTab('Circles', 'public/plugins/gridprotectionalliance-phasormap-panel/partials/circle_options.html', 3);\n        //console.log('init-edit-mode');\r\n    }\r\n\r\n    onPanelTeardown() {\r\n        this.map.off('zoomend');\r\n        this.map.off('moveend');\r\n        //console.log('panel-teardown');\r\n    }\r\n\r\n    onPanelInitialized(){\r\n        //console.log('panel-initialized');\r\n    }\r\n\r\n    onRefresh() {\n        var ctrl = this;\n\n        if (ctrl.height > ctrl.row.height) ctrl.render();\n\n        //console.log('refresh');\r\n    }\n\n    onResize() {\n        var ctrl = this;\n        console.log('refresh');\r\n    }\n\n    onRender() {\n        //console.log('render');\r\n    }\n\n    onDataRecieved(data) {\n        var ctrl = this;\n\n        ctrl.createMap()\n\n        if (ctrl.$scope.metaData == null || ctrl.editMode) {\n            ctrl.getMetadata(data);\n        }\n        else {\n            ctrl.updateData(data);\n        }\n        //console.log('data-recieved');\r\n    }\n\n    onDataError(msg) {\n        console.log('data-error');\r\n    }\n    // #endregion\n\r\n    // #region Map and Marker Creation\r\n    createMap() {\r\n        var ctrl = this;\r\n\r\n        if (ctrl.$scope.mapContainer == null) {\r\n\r\n            var mapOptions = {\r\n                zoomControl: false,\r\n                attributionControl: false,\r\n                boxZoom: false,\r\n                doubleClickZoom: false,\r\n                dragging: (ctrl.panel.lockMap == 'No'),\r\n                zoomDelta: (ctrl.panel.lockMap == 'No'? 1: 0),\r\n                minZoom: (ctrl.panel.lockMap == 'No' ? ctrl.panel.minZoom : ctrl.panel.zoomLevel),\r\n                maxZoom: (ctrl.panel.lockMap == 'No' ? ctrl.panel.maxZoom : ctrl.panel.zoomLevel)\r\n            };\r\n\r\n            ctrl.$scope.mapContainer = L.map('mapid_' + ctrl.panel.id, mapOptions);\r\n            ctrl.$scope.tileLayer = L.tileLayer(tileServers[ctrl.panel.mapBackground].url, tileServers[ctrl.panel.mapBackground].options);\r\n            ctrl.$scope.tileLayer.addTo(ctrl.$scope.mapContainer);\r\n            ctrl.updateMapView();\r\n            ctrl.$scope.mapContainer.off('zoomend');\r\n            ctrl.$scope.mapContainer.on('zoomend', function (event) {\r\n                ctrl.panel.zoomLevel = ctrl.$scope.mapContainer.getZoom();\r\n\r\n                var bounds = ctrl.$scope.mapContainer.getBounds();\r\n                ctrl.panel.maxLongitude = bounds._southWest.lng;\r\n                ctrl.panel.maxLatitude = bounds._northEast.lat;\r\n                ctrl.panel.minLatitude = bounds._southWest.lat;\r\n                ctrl.panel.minLongitude = bounds._northEast.lng;\r\n\r\n                ctrl.refresh();\r\n            });\r\n            ctrl.$scope.mapContainer.off('moveend');\r\n            ctrl.$scope.mapContainer.on('moveend', function (event) {\r\n                ctrl.panel.zoomLevel = ctrl.$scope.mapContainer.getZoom();\r\n\r\n                var bounds = ctrl.$scope.mapContainer.getBounds();\r\n                ctrl.panel.maxLongitude = bounds._southWest.lng;\r\n                ctrl.panel.maxLatitude = bounds._northEast.lat;\r\n                ctrl.panel.minLatitude = bounds._southWest.lat;\r\n                ctrl.panel.minLongitude = bounds._northEast.lng;\r\n\r\n                ctrl.refresh();\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    plotMetaData() {\r\n        var ctrl = this;\r\n\r\n        _.each(ctrl.$scope.circleMarkers, function (element, index, list) {\r\n            element.remove();\r\n        });\r\n\r\n        _.each(ctrl.$scope.phasorPairs, function (element, index, list) {\r\n            var r = parseInt(ctrl.panel.circleRadius.toString()) * 1.2;\r\n            var divIcon = L.divIcon({\r\n                html: '<canvas width=\"' + 2 * r + '\" height=\"' + 2 * r + '\" style=\"position:relative; top:-' + (r - 5) + 'px;left:-' + (r - 5) + 'px\"></canvas>',\r\n                iconSize: [12, 12]\r\n            });\r\n            var circle = L.marker([element.Latitude, element.Longitude], { icon: divIcon });\r\n            ctrl.$scope.circleMarkers.push(circle);\r\n            circle.addTo(ctrl.$scope.mapContainer);\r\n            ctrl.$scope.phasorPairs[index].divIcon = circle._icon;\r\n            ctrl.updatePhasorChart(index);\r\n        });\r\n    }\r\n\r\n    updatePhasorChart(phasorId) {\r\n        var ctrl = this;\r\n\r\n        var phasor = ctrl.$scope.phasorPairs[phasorId];\r\n\r\n        var canvas = $(phasor.divIcon).children();\r\n        var context = canvas[0].getContext(\"2d\");\r\n        context.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n        var center = { x: canvas.width() / 2, y: canvas.height() / 2 };\r\n        var chartRadius = ctrl.panel.circleRadius;\r\n\r\n        function drawBackground()\r\n        {\r\n            context.strokeStyle = \"#000000\";\r\n            context.beginPath();\r\n            context.arc(center.x, center.y, chartRadius, 0, 2 * Math.PI);\r\n            context.stroke();\r\n            context.fillStyle = \"#FFFFFF\";\r\n            context.fill();\r\n\r\n        }\r\n\r\n        function drawGrid() {\r\n            context.lineWidth = 1;\r\n            context.strokeStyle = \"#DDD\";\r\n            for (var i = 0; i < 18; i++)\r\n                drawVector(chartRadius, i * Math.PI / 9);\r\n            for (var i = 1; i < 8; i++)\r\n                drawCircle(1 * chartRadius * i / 8);\r\n        }\r\n\r\n        function drawPhasors() {\r\n            var vMax = 0;\r\n            var iMax = 0;\r\n\r\n            context.lineWidth = 3;\r\n\r\n            $.each(phasorData, function (key, series) {\r\n                if (series == undefined)\r\n                    return;\r\n\r\n                if (series.color == undefined)\r\n                    return;\r\n\r\n                $.each(series.data, function (_, dataPoint) {\r\n                    series.vector = dataPoint;\r\n\r\n                    if (dataPoint[0] >= xaxisHover)\r\n                        return false;\r\n                });\r\n\r\n                if (key < 3 && series.vector[1] > vMax)\r\n                    vMax = series.vector[1];\r\n                if (key >= 3 && series.vector[1] > iMax)\r\n                    iMax = series.vector[1];\r\n            });\r\n\r\n            $.each(phasorData, function (key, series) {\r\n                var scale;\r\n\r\n                if (series == undefined)\r\n                    return;\r\n\r\n                if (series.vector == undefined)\r\n                    return;\r\n\r\n                if (key < 3) {\r\n                    scale = 0.9 * chartRadius / vMax;\r\n                }\r\n                else {\r\n                    scale = 0.9 * chartRadius / iMax;\r\n                    context.setLineDash([10, 5]);\r\n                }\r\n\r\n                context.strokeStyle = series.color;\r\n                drawVector(series.vector[1] * scale, series.vector[2]);\r\n                context.setLineDash([]);\r\n            });\r\n        }\r\n\r\n        function drawVector(r, t) {\r\n            var x = r * Math.cos(t);\r\n            var y = r * Math.sin(t);\r\n\r\n            context.beginPath();\r\n            context.moveTo(center.x, center.y);\r\n            context.lineTo(center.x + x, center.y - y);\r\n            context.stroke();\r\n        }\r\n\r\n        function drawCircle(r) {\r\n            context.beginPath();\r\n            context.arc(center.x, center.y, r, 0, 2 * Math.PI);\r\n            context.stroke();\r\n        }\r\n\r\n        function drawAngleArrow(angle) {\r\n\r\n            angle = angle - 90;\r\n            var radians = angle * (Math.PI / 180);\r\n\r\n            var headlen = 5;   // length of head in pixels\r\n            var x = chartRadius * Math.cos(radians) + center.x;\r\n            var y = chartRadius * Math.sin(radians) + center.y;\r\n\r\n            context.strokeStyle = \"#000000\";\r\n            context.beginPath();\r\n            context.moveTo(center.x, center.y);\r\n            context.lineTo(x, y);\r\n            context.lineTo(x - headlen * Math.cos(radians - Math.PI / 6), y - headlen * Math.sin(radians - Math.PI/6));\r\n            context.moveTo(x, y);\r\n            context.lineTo(x - headlen * Math.cos(radians + Math.PI / 6), y - headlen * Math.sin(radians + Math.PI / 6));\r\n            context.stroke();\r\n        }\r\n\r\n        function drawMagCircle(magnitude) {\r\n            context.strokeStyle = \"#FFFF00\";\r\n            context.beginPath();\r\n            context.arc(center.x, center.y, chartRadius*(magnitude/2000), 0, 2 * Math.PI);\r\n            context.stroke();\r\n            context.fillStyle = \"#FFFF00\";\r\n            context.fill();\r\n\r\n        }\r\n\r\n        function drawAverageLine(angle) {\r\n            angle = angle - 90;\r\n            var radians = angle * (Math.PI / 180);\r\n\r\n            var x = chartRadius * Math.cos(radians) + center.x;\r\n            var y = chartRadius * Math.sin(radians) + center.y;\r\n\r\n            context.strokeStyle = \"#FF0000\";\r\n            context.beginPath();\r\n            context.moveTo(center.x, center.y);\r\n            context.lineTo(x, y);\r\n            context.stroke();\r\n        }\r\n\r\n\r\n        drawBackground();\r\n        drawGrid();\r\n        drawMagCircle(phasor.MagnitudeValue);\r\n\r\n        drawAngleArrow(phasor.AngleValue);\r\n        if (phasor.angleMean)\r\n            drawAverageLine(phasor.angleMean);\r\n    }\r\n\r\n    // #endregion\r\n\r\n    // #region Data\r\n    getMetadata(data) {\r\n        var ctrl = this;\r\n        if (ctrl.datasource.getMetaData == undefined) return;\r\n        ctrl.$scope.phasorPairs = {};\n        $('canvas').remove();\n        ctrl.datasource.getMetaData(data.map(x => { return \"'\" + x.pointtag + \"'\" }).join(',')).then(function (d) {\n            if (d.data == \"\") return;\n            ctrl.$scope.metaData = JSON.parse(d.data);\r\n            _.each(ctrl.$scope.metaData, function (element, index, list) {\r\n                if (element.PhasorID == null) return;\r\n\r\n                if (!ctrl.$scope.phasorPairs.hasOwnProperty(element.PhasorID))\r\n                    ctrl.$scope.phasorPairs[element.PhasorID] = {};\r\n\r\n                ctrl.$scope.phasorPairs[element.PhasorID].PhasorType = element.PhasorType;\r\n                ctrl.$scope.phasorPairs[element.PhasorID].Latitude = element.Latitude;\r\n                ctrl.$scope.phasorPairs[element.PhasorID].Longitude = element.Longitude;\r\n\r\n\r\n                if (element.SignalType.indexOf('PHM') >= 0) {\r\n                    ctrl.$scope.phasorPairs[element.PhasorID].MagnitudeTag = element.PointTag;\r\n                    ctrl.$scope.phasorPairs[element.PhasorID].MagnitudeValue = 0;\r\n                }\r\n                else if (element.SignalType.indexOf('PHA') >= 0) {\r\n                    ctrl.$scope.phasorPairs[element.PhasorID].AngleTag = element.PointTag;\r\n                    ctrl.$scope.phasorPairs[element.PhasorID].AngleValue = 0;\r\n                }\r\n\r\n\r\n            });\r\n\r\n            ctrl.plotMetaData();\r\n\r\n            ctrl.updateData(data);\r\n        });\r\n\r\n    }\r\n\r\n    updateData(data) {\r\n        var ctrl = this;\r\n        var refpoints = null;\r\n\r\n        var refAngle = 0;\r\n        if (ctrl.panel.useReferenceValue) {\r\n            var tag = _.find(data, function (o) { return o.pointtag == ctrl.panel.referencePointTag.AngleTag });\r\n            refAngle = tag.datapoints[tag.datapoints.length - 1][0];\r\n\r\n            if (ctrl.panel.useAngleMean) {\r\n                var timeWindow = ctrl.panel.angleMeanTimeWindow * 60 * 1000;\r\n                var lastTime = tag.datapoints[tag.datapoints.length-1][1];\r\n                var firstTime = lastTime - timeWindow;\r\n\r\n                refpoints = _.filter(tag.datapoints, function (v) { return v[1] > firstTime });\r\n            }\r\n\r\n        }\r\n\r\n        \r\n\r\n\r\n        _.each(data, function (element, index, list) {\r\n            var phasorId = _.find(ctrl.$scope.metaData, function (o) {\r\n                return element.pointtag == o.PointTag\r\n            }).PhasorID;\r\n\r\n\r\n            if (element.pointtag == ctrl.$scope.phasorPairs[phasorId].MagnitudeTag && element.datapoints.length > 0) {\r\n                ctrl.$scope.phasorPairs[phasorId].MagnitudeValue = element.datapoints[element.datapoints.length - 1][0];\r\n            }\r\n            else if (element.pointtag == ctrl.$scope.phasorPairs[phasorId].AngleTag && element.datapoints.length > 0) {\r\n                ctrl.$scope.phasorPairs[phasorId].AngleValue = element.datapoints[element.datapoints.length - 1][0] - refAngle;\r\n\r\n                if (ctrl.panel.useAngleMean) {\r\n                    var timeWindow = ctrl.panel.angleMeanTimeWindow * 60 * 1000;\r\n                    var i = element.datapoints.length - 1;\r\n                    var lastTime = element.datapoints[i][1];\r\n                    var firstTime = lastTime - timeWindow;\r\n\r\n                    var anglepoints = _.filter(element.datapoints, function (v) { return v[1] > firstTime });\r\n\r\n                    _.each(anglepoints, function (e, j, l) {\r\n                        if (ctrl.panel.useReferenceValue && e[1] == refpoints[j][1])\r\n                            e = e - refpoints[i][1];\r\n                    });\r\n\r\n                    ctrl.$scope.phasorPairs[phasorId].angleMean = _.mean(_.map(anglepoints, function (o) { return o[0];}));\r\n                }\r\n                else\r\n                    ctrl.$scope.phasorPairs[phasorId].angleMean = null;\r\n            }\r\n\r\n\r\n            ctrl.updatePhasorChart(phasorId);\r\n\r\n        });\r\n\r\n        \r\n    }\r\n\r\n    // #endregion\r\n\r\n    // #region Options Functions\r\n    changeMapBackground() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.tileLayer.remove();\r\n        ctrl.$scope.tileLayer = L.tileLayer(tileServers[this.panel.mapBackground].url, tileServers[this.panel.mapBackground].options);\r\n        ctrl.$scope.tileLayer.addTo(this.$scope.mapContainer);\r\n    }\r\n\r\n    updateZoom() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.mapContainer.options.minZoom = (ctrl.panel.lockMap == 'No' ? ctrl.panel.minZoom : ctrl.panel.zoomLevel);\r\n        ctrl.$scope.mapContainer.options.maxZoom = (ctrl.panel.lockMap == 'No' ? ctrl.panel.maxZoom : ctrl.panel.zoomLevel);\r\n\r\n        ctrl.$scope.mapContainer.setZoom(ctrl.panel.zoomLevel);\r\n    }\r\n\r\n    updateMapView() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.mapContainer.fitBounds([\r\n            [ctrl.panel.maxLatitude, ctrl.panel.maxLongitude],\r\n            [ctrl.panel.minLatitude, ctrl.panel.minLongitude]\r\n        ]);\r\n    }\r\n\r\n    lockMap() {\r\n        var ctrl = this;\r\n\r\n        ctrl.$scope.mapContainer.remove();\r\n        ctrl.$scope.mapContainer = null;\r\n        ctrl.createMap();\r\n        ctrl.plotMetaData();\r\n    }\r\n\r\n    boundToMarkers() {\r\n        var ctrl = this;\r\n\r\n        var markerGroup = new L.featureGroup(ctrl.$scope.circleMarkers);\r\n        if (markerGroup.getBounds().isValid())\r\n            ctrl.$scope.mapContainer.fitBounds(markerGroup.getBounds());\r\n\r\n        var bounds = ctrl.$scope.mapContainer.getBounds();\r\n        ctrl.panel.maxLongitude = bounds._southWest.lng;\r\n        ctrl.panel.maxLatitude = bounds._northEast.lat;\r\n        ctrl.panel.minLatitude = bounds._southWest.lat;\r\n        ctrl.panel.minLongitude = bounds._northEast.lng;\r\n    }\r\n    //#endregion\r\n\r\n    // #region Angular Tag Functions\r\n    getRange(min, max, step) {\r\n        step = step || 1;\r\n        var input = [];\r\n        for (var i = min; i <= max; i += step) {\r\n            input.push(i);\r\n        }\r\n        return input;\r\n    }\r\n    // #endregion\r\n    \r\n\r\n}\r\n\r\nPhasorMapCtrl.templateUrl = 'partials/module.html';\r\n"]}